---
# Playbook: Create Custom Menu Categories
# Creates custom menu categories for Kali Linux
# Usage: ansible-playbook playbooks/menu.yml

- name: Create Custom Menu Categories
  hosts: raspberry_pis
  become: true

  tasks:
    # ========================================
    # 17 - SDR Menu
    # ========================================
    - name: Create SDR menu directory entry
      ansible.builtin.copy:
        dest: /usr/share/desktop-directories/sdr-radio.directory
        content: |
          [Desktop Entry]
          Name=17 - SDR
          Comment=Software Defined Radio Tools
          Icon=gnuradio-grc
          Type=Directory
        mode: '0644'

    - name: Create SDR menu configuration
      ansible.builtin.copy:
        dest: /etc/xdg/menus/applications-merged/sdr-radio.menu
        content: |
          <!DOCTYPE Menu PUBLIC "-//freedesktop//DTD Menu 1.0//EN"
            "http://www.freedesktop.org/standards/menu-spec/menu-1.0.dtd">
          <Menu>
            <Name>Applications</Name>
            <Menu>
              <Name>SDR-Radio</Name>
              <Directory>sdr-radio.directory</Directory>
              <Include>
                <Filename>sdrpp.desktop</Filename>
                <Filename>urh.desktop</Filename>
                <Filename>sdrangel.desktop</Filename>
              </Include>
            </Menu>
          </Menu>
        mode: '0644'

    - name: Update SDR++ desktop entry with SDR category
      ansible.builtin.copy:
        dest: /usr/share/applications/sdrpp.desktop
        content: |
          [Desktop Entry]
          Name=SDR++
          Comment=Cross-Platform SDR Software
          Exec=sdrpp
          Icon=gqrx
          Terminal=false
          Type=Application
          Categories=SDR-Radio;Network;HamRadio;
        mode: '0644'

    - name: Update URH desktop entry with SDR category
      ansible.builtin.copy:
        dest: /usr/share/applications/urh.desktop
        content: |
          [Desktop Entry]
          Name=Universal Radio Hacker
          Comment=Investigate wireless protocols like a boss
          Exec=urh
          Icon=gnuradio-grc
          Terminal=false
          Type=Application
          Categories=SDR-Radio;Network;HamRadio;Development;
        mode: '0644'

    - name: Update SDRAngel desktop entry with SDR category
      ansible.builtin.copy:
        dest: /usr/share/applications/sdrangel.desktop
        content: |
          [Desktop Entry]
          Name=SDRAngel
          Comment=SDR Rx/Tx Software
          Exec=sdrangel
          Icon=kali-gqrx
          Terminal=false
          Type=Application
          Categories=SDR-Radio;Network;HamRadio;
        mode: '0644'

    - name: Update menu cache
      ansible.builtin.command: update-desktop-database /usr/share/applications
      changed_when: true

    # ========================================
    # 18 - Docker Menu
    # ========================================
    - name: Create Docker menu directory entry
      ansible.builtin.copy:
        dest: /usr/share/desktop-directories/docker-tools.directory
        content: |
          [Desktop Entry]
          Name=18 - Docker
          Comment=Docker Management Tools
          Icon=network-server
          Type=Directory
        mode: '0644'

    - name: Create Docker menu configuration
      ansible.builtin.copy:
        dest: /etc/xdg/menus/applications-merged/docker-tools.menu
        content: |
          <!DOCTYPE Menu PUBLIC "-//freedesktop//DTD Menu 1.0//EN"
            "http://www.freedesktop.org/standards/menu-spec/menu-1.0.dtd">
          <Menu>
            <Name>Applications</Name>
            <Menu>
              <Name>Docker-Tools</Name>
              <Directory>docker-tools.directory</Directory>
              <Include>
                <Filename>portainer.desktop</Filename>
              </Include>
            </Menu>
          </Menu>
        mode: '0644'

    - name: Create Portainer desktop entry
      ansible.builtin.copy:
        dest: /usr/share/applications/portainer.desktop
        content: |
          [Desktop Entry]
          Name=Portainer
          Comment=Docker Container Management
          Exec=xdg-open https://localhost:9443
          Icon=web-browser
          Terminal=false
          Type=Application
          Categories=Docker-Tools;System;
        mode: '0644'

    - name: Update menu cache for Docker
      ansible.builtin.command: update-desktop-database /usr/share/applications
      changed_when: true

    - name: Display completion message
      ansible.builtin.debug:
        msg: "Custom menu categories created successfully"